/*
Advanced React Portfolio - Single File
- TailwindCSS required
- Dependencies recommended: framer-motion, lucide-react, react-helmet-async, recharts
- Drop into a Vite/CRA project as src/App.jsx (or src/components/RagulPortfolio.jsx and import into App)
- Includes: responsive layout, theme toggle, settings panel (accent color, font-size, reduced-motion, show/hide sections), SEO, contact form (Formspree), animated sections, chart placeholder, accessible markup.
*/

import React, { useEffect, useState } from "react";
import { Helmet, HelmetProvider } from "react-helmet-async";
import { motion, AnimatePresence } from "framer-motion";
import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer } from "recharts";
import { Sun, Moon, Settings } from "lucide-react";

const defaultDataForChart = [
  { name: "Jan", value: 30 },
  { name: "Feb", value: 45 },
  { name: "Mar", value: 60 },
  { name: "Apr", value: 50 },
  { name: "May", value: 80 },
];

export default function RagulPortfolioAdvanced() {
  // Load initial from localStorage for persistent user settings
  const [dark, setDark] = useState(() => JSON.parse(localStorage.getItem("rr_dark")) || false);
  const [accent, setAccent] = useState(() => localStorage.getItem("rr_accent") || "indigo");
  const [fontScale, setFontScale] = useState(() => parseFloat(localStorage.getItem("rr_fontScale")) || 1);
  const [reducedMotion, setReducedMotion] = useState(() => JSON.parse(localStorage.getItem("rr_reducedMotion")) || false);
  const [showSettings, setShowSettings] = useState(false);
  const [openSections, setOpenSections] = useState(() => JSON.parse(localStorage.getItem("rr_openSections")) || { projects: true, experience: true, certs: true });

  useEffect(() => {
    localStorage.setItem("rr_dark", JSON.stringify(dark));
  }, [dark]);
  useEffect(() => {
    localStorage.setItem("rr_accent", accent);
  }, [accent]);
  useEffect(() => {
    localStorage.setItem("rr_fontScale", fontScale.toString());
  }, [fontScale]);
  useEffect(() => {
    localStorage.setItem("rr_reducedMotion", JSON.stringify(reducedMotion));
  }, [reducedMotion]);
  useEffect(() => {
    localStorage.setItem("rr_openSections", JSON.stringify(openSections));
  }, [openSections]);

  // Mocked content pulled from your old portfolio (you can replace / fetch from a JSON endpoint)
  const site = {
    name: "R Ragul Renganath",
    headline: "MBA Finance Candidate · Economics Graduate",
    about: `Born and raised in Kodaikanal. I blend economic thinking with financial analytics to craft data-driven solutions in corporate finance and public policy. My work emphasizes clarity, measurable impact, and the humane side of data.",
    contact: {
      email: "renganathr2135@gmail.com",
      phone: "+91 93458 84864",
      linkedIn: "https://www.linkedin.com/in/ragul-renganath/",
      location: "Kodaikanal, Tamil Nadu, India",
    },
    education: [
      { title: "MBA in Finance", org: "Amrita School of Business, Coimbatore", period: "2025–2027", notes: "Specialization in Finance, Financial Modelling, Corporate Finance, Analytics." },
      { title: "Bachelor in Economics", org: "PSG College of Arts & Science", period: "2022–2025", notes: "UG in Economics — Distinction (CGPA: 8.9)." },
    ],
    experience: [
      { title: "Export Operation Intern", org: "SRIE Flora Garments", period: "May 2024 – Jun 2024", bullets: ["Implemented quality checks that reduced defects by 10%", "Standardized SOPs across two production lines"] },
    ],
    projects: [
      { title: "Global Sugar Trade Study", summary: "Trade flows, pricing, & policy analysis with econometric insights.", tags: ["Trade", "Policy", "Econometrics"] },
    ],
    certifications: [
      { title: "SEBI Investor Certification", notes: "Valid: Dec 2024 – Dec 2026" },
      { title: "Tata Virtual Experience – Data Viz", notes: "2024" },
    ],
    skills: { core: ["Financial Analysis", "Quantitative Research", "Excel", "R"], tools: ["Excel", "R", "Tableau", "Power BI"] },
  };

  // Accessibility: respect reduced motion
  const motionProps = reducedMotion ? { transition: { duration: 0 } } : { layout: true, initial: { opacity: 0, y: 10 }, animate: { opacity: 1, y: 0 }, exit: { opacity: 0, y: -10 }, transition: { duration: 0.45 } };

  // Accent color mapping to Tailwind utility class suffixes
  const accentMap = {
    indigo: "indigo-600",
    rose: "rose-600",
    emerald: "emerald-600",
    amber: "amber-600",
    slate: "slate-600",
  };

  // Utility: dynamic inline styles for accent buttons (keeps Tailwind purging friendly by listing classes in markup too)
  const accentClass = accentMap[accent] || accentMap.indigo;

  return (
    <HelmetProvider>
      <div className={dark ? "min-h-screen bg-gray-900 text-gray-100" : "min-h-screen bg-white text-gray-900"} style={{ fontSize: `${fontScale}rem` }}>
        <Helmet>
          <title>{site.name} — Portfolio</title>
          <meta name="description" content="Ragul Renganath — MBA Finance Candidate. Financial analysis, data-driven research, and economic insight." />
          <meta name="viewport" content="width=device-width, initial-scale=1" />
        </Helmet>

        {/* Header */}
        <header className="max-w-7xl mx-auto p-4 md:p-6 flex items-center justify-between">
          <div>
            <h1 className="text-xl md:text-2xl font-extrabold tracking-tight">{site.name}</h1>
            <p className="text-sm md:text-base opacity-80">{site.headline}</p>
          </div>

          <div className="flex items-center gap-3">
            <button
              aria-label="settings"
              onClick={() => setShowSettings((s) => !s)}
              className="p-2 rounded-md hover:shadow focus:outline-none border"
              title="Settings"
            >
              <Settings size={16} />
            </button>

            <button
              aria-label="toggle-theme"
              onClick={() => setDark((d) => !d)}
              className="p-2 rounded-md hover:shadow focus:outline-none border"
            >
              {dark ? <Sun size={16} /> : <Moon size={16} />}
            </button>

            <a href={`mailto:${site.contact.email}`} className={`px-3 py-2 rounded-md border hover:shadow text-sm md:text-base`}>
              Contact
            </a>
          </div>
        </header>

        <main className="max-w-7xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Left: main content */}
          <section className="lg:col-span-2 space-y-6">
            <AnimatePresence>
              <motion.article className={`p-6 rounded-2xl shadow-sm border`}
                {...motionProps}
              >
                <div className="flex items-start gap-4 md:gap-6">
                  <div className={`w-20 h-20 rounded-full bg-${accent} flex items-center justify-center text-white font-bold text-xl md:text-2xl`} style={{ backgroundColor: "", minWidth: 80 }}>
                    RR
                  </div>

                  <div>
                    <h2 className="text-lg md:text-xl font-semibold">About</h2>
                    <p className="mt-2 text-sm md:text-base leading-relaxed">{site.about}</p>
                    <div className="mt-3 flex flex-wrap gap-2">
                      <a href="#projects" className="text-sm underline">Projects</a>
                      <a href="#education" className="text-sm underline">Education</a>
                      <a href="#contact" className="text-sm underline">Contact</a>
                    </div>
                  </div>
                </div>
              </motion.article>
            </AnimatePresence>

            {/* Projects */}
            <motion.section id="projects" className="p-6 rounded-2xl shadow-sm border" {...motionProps}>
              <div className="flex items-center justify-between">
                <h3 className="text-lg font-semibold">Projects</h3>
                <div className="text-sm opacity-70">Selected & Ongoing</div>
              </div>

              <div className="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                {site.projects.map((p, i) => (
                  <article key={i} className="p-4 border rounded-lg hover:shadow transition-shadow">
                    <h4 className="font-semibold">{p.title}</h4>
                    <p className="text-sm mt-2 leading-relaxed">{p.summary}</p>
                    <div className="mt-3 flex flex-wrap gap-2">
                      {p.tags.map((t) => (
                        <span key={t} className="text-xs px-2 py-1 border rounded-full">{t}</span>
                      ))}
                    </div>
                    <div className="mt-3 flex gap-2">
                      <a className="text-sm text-[] underline" href="#">Case Study</a>
                      <a className="text-sm text-[] underline" href="#">Repo</a>
                    </div>
                  </article>
                ))}
              </div>
            </motion.section>

            {/* Experience */}
            <motion.section className="p-6 rounded-2xl shadow-sm border" {...motionProps}>
              <div className="flex items-center justify-between">
                <h3 className="text-lg font-semibold">Experience</h3>
                <div className="text-sm opacity-70">Impact & Tools</div>
              </div>

              <div className="mt-4 space-y-4">
                {site.experience.map((e, idx) => (
                  <div key={idx} className="border p-4 rounded-lg">
                    <div className="flex items-start justify-between">
                      <div>
                        <h4 className="font-semibold">{e.title} <span className="opacity-80">— {e.org}</span></h4>
                        <div className="text-xs opacity-70">{e.period}</div>
                      </div>
                      <div className="text-right text-xs font-semibold text-green-500">10% impact</div>
                    </div>

                    <ul className="mt-3 list-disc ml-5 text-sm leading-relaxed">
                      {e.bullets.map((b, i) => (
                        <li key={i}>{b}</li>
                      ))}
                    </ul>
                  </div>
                ))}
              </div>
            </motion.section>

            {/* Data Viz / Chart placeholder */}
            <motion.section className="p-6 rounded-2xl shadow-sm border" {...motionProps}>
              <div className="flex items-center justify-between">
                <h3 className="text-lg font-semibold">Quick Metrics</h3>
                <div className="text-sm opacity-70">Sample visualization</div>
              </div>

              <div className="mt-4 h-56">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart data={defaultDataForChart} margin={{ top: 10, right: 20, left: 0, bottom: 0 }}>
                    <XAxis dataKey="name" />
                    <YAxis />
                    <Tooltip />
                    <Bar dataKey="value" fill="#4f46e5" />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </motion.section>

            {/* Certifications */}
            <motion.section className="p-6 rounded-2xl shadow-sm border" {...motionProps}>
              <h3 className="text-lg font-semibold">Certifications & Highlights</h3>
              <div className="mt-4 grid md:grid-cols-2 gap-3">
                {site.certifications.map((c, i) => (
                  <div key={i} className="p-3 border rounded-lg text-sm">
                    <div className="font-medium">{c.title}</div>
                    <div className="opacity-80 mt-1 text-xs">{c.notes}</div>
                  </div>
                ))}
              </div>
            </motion.section>
          </section>

          {/* Right column: sidebar */}
          <aside className="space-y-6">
            <div className="p-6 rounded-2xl shadow-sm border sticky top-6">
              <h4 className="text-lg font-semibold">Education</h4>
              <div className="mt-3 text-sm space-y-3">
                {site.education.map((ed, i) => (
                  <div key={i}>
                    <div className="font-medium">{ed.title}</div>
                    <div className="opacity-80 text-xs">{ed.org} · {ed.period}</div>
                    <div className="mt-1 text-xs">{ed.notes}</div>
                  </div>
                ))}
              </div>
            </div>

            <div className="p-6 rounded-2xl shadow-sm border">
              <h4 className="text-lg font-semibold">Skills</h4>
              <div className="mt-3">
                <div className="text-sm font-medium">Core</div>
                <ul className="text-sm mt-2 list-disc ml-5">
                  {site.skills.core.map((s) => (<li key={s}>{s}</li>))}
                </ul>
                <div className="text-sm font-medium mt-3">Tools</div>
                <ul className="text-sm mt-2 list-disc ml-5">
                  {site.skills.tools.map((s) => (<li key={s}>{s}</li>))}
                </ul>
              </div>
            </div>

            <div id="contact" className="p-6 rounded-2xl shadow-sm border">
              <h4 className="text-lg font-semibold">Contact</h4>
              <div className="mt-3 text-sm">
                <div><strong>Email:</strong> <a className="underline" href={`mailto:${site.contact.email}`}>{site.contact.email}</a></div>
                <div><strong>Phone:</strong> {site.contact.phone}</div>
                <div className="mt-2"><a href={site.contact.linkedIn} target="_blank" rel="noreferrer" className="underline">LinkedIn</a></div>
                <form className="mt-3 space-y-2" action="https://formspree.io/f/{your_form_id}" method="POST">
                  <input type="hidden" name="_subject" value="New contact from portfolio" />
                  <input className="w-full border rounded-md px-3 py-2 text-sm" name="name" placeholder="Your name" />
                  <input className="w-full border rounded-md px-3 py-2 text-sm" name="email" placeholder="Your email" />
                  <textarea className="w-full border rounded-md px-3 py-2 text-sm" name="message" placeholder="Message" rows={3}></textarea>
                  <button type="submit" className={`w-full py-2 rounded-md bg-${accent} text-white`}>Send</button>
                </form>
              </div>
            </div>

            <div className="p-6 rounded-2xl shadow-sm border">
              <h4 className="text-lg font-semibold">Quick Actions</h4>
              <div className="mt-3 flex flex-col gap-2">
                <a className="text-sm border px-3 py-2 rounded-md text-center" href={`mailto:${site.contact.email}?subject=Opportunity`}>Email me</a>
                <a className="text-sm border px-3 py-2 rounded-md text-center" href="#projects">View projects</a>
                <a className="text-sm border px-3 py-2 rounded-md text-center" href="/resume.pdf">Download Resume</a>
              </div>
            </div>
          </aside>
        </main>

        <footer className="max-w-7xl mx-auto p-6 text-center text-sm opacity-70">© {new Date().getFullYear()} {site.name}. All Rights Reserved.</footer>

        {/* Settings drawer (floating) */}
        <AnimatePresence>
          {showSettings && (
            <motion.aside className={`fixed right-4 bottom-6 w-80 md:w-96 z-50`} initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 10 }}>
              <div className={`p-4 rounded-xl shadow-lg border bg-white text-gray-900`}>
                <div className="flex items-center justify-between">
                  <h4 className="font-semibold">Settings</h4>
                  <div className="text-xs opacity-70">Personalize</div>
                </div>

                <div className="mt-3 space-y-3 text-sm">
                  <div>
                    <label className="flex items-center gap-2">
                      <input type="checkbox" checked={reducedMotion} onChange={(e) => setReducedMotion(e.target.checked)} />
                      Respect reduced motion
                    </label>
                  </div>

                  <div>
                    <label className="block text-xs">Accent color</label>
                    <div className="mt-2 flex gap-2">
                      {Object.keys(accentMap).map((a) => (
                        <button key={a} onClick={() => setAccent(a)} className={`w-8 h-8 rounded-full border ${a === accent ? "ring-2 ring-offset-2" : ""}`} aria-label={a}></button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-xs">Font scale</label>
                    <input type="range" min={0.9} max={1.2} step={0.05} value={fontScale} onChange={(e) => setFontScale(parseFloat(e.target.value))} />
                  </div>

                  <div>
                    <label className="block text-xs">Sections</label>
                    <div className="mt-2 grid grid-cols-2 gap-2">
                      {Object.keys(openSections).map((k) => (
                        <label key={k} className="flex items-center gap-2 text-xs border rounded-md px-2 py-1">
                          <input type="checkbox" checked={openSections[k]} onChange={(e) => setOpenSections((s) => ({ ...s, [k]: e.target.checked }))} />
                          {k}
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="pt-2 border-t flex gap-2">
                    <button className="px-3 py-2 rounded-md border text-sm" onClick={() => { setShowSettings(false); }}>Close</button>
                    <button className="px-3 py-2 rounded-md bg-indigo-600 text-white text-sm" onClick={() => { localStorage.clear(); window.location.reload(); }}>Reset</button>
                  </div>
                </div>
              </div>
            </motion.aside>
          )}
        </AnimatePresence>

      </div>
    </HelmetProvider>
  );
}

/*
How to use & advanced settings (summary):
- Tailwind: this component assumes Tailwind is configured. Add the Tailwind CDN for quick preview, or install properly via PostCSS.
- Libraries to install: framer-motion, react-helmet-async, lucide-react, recharts. Run: npm i framer-motion react-helmet-async lucide-react recharts
- Accessibility: reduced-motion option respects users who prefer less animation.
- The settings floating panel stores preferences in localStorage (dark, accent, fontScale, reducedMotion, openSections).
- Contact form: replace {your_form_id} in the Formspree URL with your form ID.
- Deployment: commit into a Vite/CRA repo and deploy to GitHub Pages or Vercel. For GitHub Pages, use gh-pages workflow or deploy build/ folder.
- SEO & Analytics: the <Helmet> tag includes title & description; add OpenGraph meta tags and a site verification meta tag if needed. For analytics, add the script tag conditionally in Helmet when you want to enable.
- Optional: connect to a headless CMS (Netlify CMS / Contentful / Sanity) for dynamic content updates without redeploy.

Advanced features you can add later:
- Authentication for an admin panel to edit content.
- A JSON endpoint (or headless CMS) for projects to be loaded dynamically.
- Internationalization (i18n) for multi-language resumes.
- Serverless contact endpoints (Netlify Functions / Vercel Serverless) to avoid third-party form services.
- PDF resume generator endpoint using Puppeteer or html2pdf for on-demand resume downloads.
- Performance: lazy-load heavy charts, tree-shake unused libs, preconnect to analytics endpoints.
*/
